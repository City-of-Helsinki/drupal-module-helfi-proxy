services:
  helfi_proxy.http_middleware:
    class: Drupal\helfi_proxy\HttpMiddleware\AssetHttpMiddleware
    arguments: ['@logger.factory']
    tags:
      - { name: http_middleware, priority: 500 }

  helfi_proxy.session_configuration:
    class: Drupal\helfi_proxy\SessionConfiguration
    decorates: session_configuration
    arguments: ['%session.storage.options%']

  helfi_proxy.path_processor:
    class: Drupal\helfi_proxy\PathProcessor\SitePrefixPathProcessor
    arguments: ['@config.factory']
    tags:
      # Must be run before PathProcessorFront (200 weight).
      - { name: path_processor_inbound, priority: 201 }
      # Must to be run after LanguageProcessorLanguage (100 weight).
      - { name: path_processor_outbound, priority: 99 }

  cache_context.site_prefix:
    class: Drupal\helfi_proxy\Cache\Context\SitePrefixCacheContext
    arguments: ['@config.factory']
    tags:
      - { name: cache.context }

  helfi_proxy.tunnistamo_redirect_subscriber:
    class: Drupal\helfi_proxy\EventSubscriber\TunnistamoRedirectUrlSubscriber
    arguments: ['@helfi_proxy.hostname']
    tags:
      - { name: event_subscriber }

  helfi_proxy.proxy_manager:
    class: Drupal\helfi_proxy\ProxyManager
    arguments: ['@config.factory', '@request_stack']
